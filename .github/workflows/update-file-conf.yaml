name: "Update log file after push"
on:
        push:
                branches:
                        - main
        workflow_dispatch:


jobs:
        append:
                runs-on: ubuntu-latest
                outputs:
                  log: ${{ steps.filter-data.outputs.log }}
                  json: ${{ steps.filter-data.outputs.log }}
                steps:
                        - uses: actions/checkout@v2
                          with:
                                  ref: ${{ github.read_ref }}

                        - name: append file
                          run: touch file.log && echo "Updated at $(date +'%Y-%m-%d %H:%M:%S')" >> file.log


                        - name: Commit differences
                          run: |
                            git config user.name "GitHub Actions Bot"
                            git config user.email "actions@github.com"
                            git add .
                            git commit -m "Append log file"
                            git push
                            
                        - uses: dorny/paths-filter@v2 # will create filters for changed files
                          id: filter-data
                          with:
                                  filters: >
                                          log: 
                                            - 'file.log'
                                          json:
                                            - 'file.json'

                            

        fire-event:
                runs-on: ubuntu-latest
                needs: append
                steps:
                        - uses: actions/checkout@v2
                          with:
                                  ref: ${{ github.read_ref }}

                        - name: "Fire event if update"
                          if: ${{ needs.append.outputs.log == 'true' }}
                          run: echo "Log file has been updated recently !"

                        - name: "Fire event if JSON file update"
                          if: ${{ needs.append.outputs.json == 'true' }}
                          run: echo "json file has been updated recently !"

