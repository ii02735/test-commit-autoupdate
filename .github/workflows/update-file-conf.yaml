name: "Update log file after push"
on:
        push:
                branches:
                        - main
        workflow_dispatch:


jobs:
        append:
                runs-on: ubuntu-latest
                steps:
                        - uses: actions/checkout@v2
                          with:
                                  ref: ${{ github.read_ref }}

                        - name: append file
                          run: touch file.log && echo "Updated at $(date +'%Y-%m-%d %H:%M:%S')" >> file.log


                        - name: Commit differences
                          uses: stefanzweifel/git-auto-commit-action@v4
                          with:
                                  commit_message: "Append log file"
                                  commit_user_name: GitHub Actions Bot
                                  commit_author: GitHub Action <actions@github.com>
                                  skip_dirty_check: false

        fire-event:
                runs-on: ubuntu-latest
                needs: append
                steps:
                        - uses: actions/checkout@v2
                          with:
                                  ref: ${{ github.read_ref }}
                        - uses: dorny/paths-filter@v2 # will create filters for changed files
                          id: filter-data
                          with:
                                  base: HEAD
                                  filters: >
                                          log: 
                                            - 'file.log'
                                          json:
                                            - 'file.json'

                        - name: "Fire event if update"
                          if: steps.filter-data.outputs.log == 'true'
                          run: echo "Log file has been updated recently !"

                        - name: "Fire event if JSON file update"
                          if: steps.filter-data.outputs.json == 'true'
                          run: echo "json file has been updated recently !"

